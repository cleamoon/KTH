b = 20/1000;
h = 40/1000;
tb = 3/1000;
th = 1/1000;
L = 2;
E = 7e10;
G = E/2/(1+0.3);
sigma_plas = 400*1e6;
Test = 0;
if Test == 1
    b = 30;
    h = 50;
    tb = 4;
    th = 4;
    L = 400;
    G = 30000;
end
A =  b*tb*2 + th*h;
xc = (2*b*tb*b/2)/A;
yc = 0;
Ixx = th*h^3/12+2*tb*b*(h/2)^2;
Iyy = th*h*(xc)^2+2*(tb*b^3/12+tb*b*(b/2-xc)^2);
Ixy = 0;
q12 = tb*h/2;
xi = q12*h/Ixx*(b^2/2);
xs = xc + xi;
Io = Ixx + Iyy + A * xs^2;
J = b*tb^3/3*2 + h*th^3/3;
AR3 = xi/2*h/2;
Gamma = 2*((h/2)^3*xi^2/3*th+tb*(4*AR3^2*b-AR3*h*b^2+h^2/12*b^3));
Pcrx = pi^2*E*Ixx/(2*L)^2;
Pcry = pi^2*E*Iyy/(2*L)^2;
Pcr_theta = A/Io*(G*J+pi^2*E*Gamma/L^2);
P = (Pcr_theta+Pcrx)/2/(1-A*xs^2/Io)-sqrt(((Pcr_theta+Pcrx)/2/(1-A*xs^2/Io))^2-Pcrx*Pcr_theta/(1-A*xs^2/Io));
sigma_cr1 = 0.385*E*(tb/b)^2;
sigma_cr2 = 3.6*E*(th/h)^2;
Pcr_plas = min([sigma_cr1, sigma_cr2, sigma_plas])*A;
Pcr_local = min([sigma_cr1, sigma_cr2])*A;
F = 100;
z = (0.01:0.01:L);
v = (F*L*(z.^2)/2-F*z.^3/6)/E/Ixx;
psi = 100*xi*L/G/J;
s = (0:0.01:2*b+h);
sigma_z = F*L/2/Iyy*(0.01:0.01:b);
y = [-h/2:h/1000:h/2];
sigma_z = F*L/2/Ixx*y;
figure;
hold on;
title('Normal stress distribution of ');
xlabel('y (m)');
ylabel('Normal stress (Pa)');
plot(y, sigma_z);

figure;
hold on;
title('Shear stress distribution');
xlabel('s (m)');
ylabel('Shear stress (Pa)');
qs = [];
i = [0:0.001:1];
sb1 = b*i;
qs1 = -[-F/Ixx]*tb*(-h/2)*sb1;  
sb2 = h*i;
qs2 = zeros(1,1001);
for j =1:1:1001
    qs2(j) = -[-F/Ixx]*th*(sb2(j)-h)*sb2(j)+qs1(end);
end
qs3 = -[-F/Ixx]*tb*(h/2)*sb1+qs2(end);
plot([(i*b) b+(i*h) b+h+(i*b)], [qs1 qs2 qs3]);

figure;
hold on;
title('Warping');
xlabel('s (m)');
ylabel('Warping (m)');
hi = [0:h/2/100:h/2];
bi = [0:b/200:b];
ws1 = xi/2*hi;
ws2 = h*xi/4-h/4*bi;
%plot([bi b+hi b+h/2+hi b+h+bi], -2*[-ws2 -ws1 ws1 ws2]*F/G/J);
plot([hi h/2+bi]+b+h/2, -2*[ws1 ws2]*F*xi/G/J, 'b-');
plot(-[hi h/2+bi]+b+h/2, 2*[ws1 ws2]*F*xi/G/J, 'b-');

figure;
hold on;
title('Normal stress distributioin about z-axel');
xlabel('z (m)');
ylabel('Normal stress (Pa)');
plot(z, -F/Ixx*(L-z).^2);